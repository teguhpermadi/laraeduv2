$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);

$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
$competency_id;

$teacherSubject = TeacherSubject::with([
  'competency' => function($query) use ($competency_id){
  
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id;

$teacherSubject = TeacherSubject::with([
  'competency' => function($query) use ($competency_id){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query) use ($competency_id){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query) use ($competency_id){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  'competency' => function($query){
  	$query->pluck('competency_id');
  },
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
  ,'studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('competency_id');
  }
],['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with([
'competency' => function($query){
  	$query->pluck('id');
  }
],['studentGrade.studentCompetency' => function($query){
	
}])->find(1);


$competency_id = '';

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency_id = TeacherSubject::with('competency')->find(1)->pluck('competency.id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query){
	$query->whereIn('competency_id', [7,8,9]);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(2);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(3);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(4);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');



$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');



$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$competency = TeacherSubject::with('competency')->find(1);
$competency_id = $competency->competency->pluck('id');

$teacherSubject = TeacherSubject::with(['studentGrade.studentCompetency' => function($query)use ($competency_id){
	$query->whereIn('competency_id', $competency_id);
}])->find(1);


$data = collect();
foreach ($teacherSubject->studentGrade as $studentGrade) {
  $competencies = collect();
  foreach($studentGrade->studentCompetency as $competency) {
  	$competencies->push([
  		'competency' => $competency, 
	  	'competency_score' => $competency->score,
  	]);	
  }
  
  $data[$studentGrade->student_id] = collect([
  	'student_id' => $studentGrade->student_id,
	'student' => $studentGrade->student,
	'competency' => $studentGrade->studentCompetency->pluck('score','competency_id'),
	'average' => $studentGrade->studentCompetency->avg('score'),
	'metadata' => $competencies,
  ]);
  
}

$data;
